<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> VideO'clock ğŸ¬</title>
    <link rel="stylesheet" href="basic.css"> 
</head>
<body>

    <h1>ì˜í™” ëŸ¬ë‹ íƒ€ì„ ê²€ìƒ‰ê¸° ğŸ¿</h1>

    <div id="controls">
        <label for="min-runtime">ìµœì†Œ ëŸ¬ë‹ íƒ€ì„ (ë¶„):</label>
        <input type="number" id="min-runtime" value="90" min="10">

        <label for="max-runtime">ìµœëŒ€ ëŸ¬ë‹ íƒ€ì„ (ë¶„):</label>
        <input type="number" id="max-runtime" value="150" min="10">

        <button id="search-button">ê²€ìƒ‰</button>
    </div>

    <div id="loading-status">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</div>

    <div id="movie-results">
        </div>

    <script>
        // âš ï¸ ì‚¬ìš©ì API í‚¤ ì„¤ì •
        const YOUR_API_KEY = "79880cd590dc68cdf6fff4c224d5162b"; 
        const BASE_URL = "https://api.themoviedb.org/3";
        const RESULTS_COUNT = 30; // ê°€ì ¸ì˜¬ ì˜í™” ê°œìˆ˜
        let allMovieData = []; // ëª¨ë“  ì˜í™” ë°ì´í„° (ì œëª©, ëŸ¬ë‹ íƒ€ì„ ë“±)ë¥¼ ì €ì¥í•  ë°°ì—´

        const resultsContainer = document.getElementById('movie-results');
        const loadingStatus = document.getElementById('loading-status');
        const searchButton = document.getElementById('search-button');

        /**
         * 1. ì¸ê¸° ì˜í™” ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ (IDë§Œ ì¶”ì¶œ)
         */
        async function fetchPopularMovieIds() {
            const popularUrl = `${BASE_URL}/movie/popular?api_key=${YOUR_API_KEY}&language=ko-KR&page=1`;
            
            try {
                console.log("API í˜¸ì¶œ : ", detailUrl);
                const response = await fetch(popularUrl);
                const data = await response.json();
                
                return data.results.slice(0, RESULTS_COUNT).map(movie => movie.id);
            } catch (error) {
                console.error("ì¸ê¸° ì˜í™” ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                loadingStatus.textContent = "ì˜¤ë¥˜: ì˜í™” ëª©ë¡ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. API í‚¤ë‚˜ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.";
                return [];
            }
        }

        /**
         * 2. ê°œë³„ ì˜í™”ì˜ ìƒì„¸ ì •ë³´ (ëŸ¬ë‹ íƒ€ì„)ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
         */
        async function fetchMovieRuntime(movieId) {
            const detailUrl = `${BASE_URL}/movie/${movieId}?api_key=${YOUR_API_KEY}&language=ko-KR`;
            
            try {
                console.log("API í˜¸ì¶œ : ", detailUrl);
                const response = await fetch(detailUrl);
                const movieDetail = await response.json();
                
                return {
                    id: movieId,
                    title: movieDetail.title,
                    runtime: movieDetail.runtime, 
                    overview: movieDetail.overview || "ì¤„ê±°ë¦¬ ì •ë³´ ì—†ìŒ",
                    poster_path: movieDetail.poster_path
                };
            } catch (error) {
                console.warn(`ì˜í™” ID ${movieId}ì˜ ìƒì„¸ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:`, error);
                return null; 
            }
        }

        /**
         * 3. ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜: ëª¨ë“  ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
         */
        async function initializeData() {
            loadingStatus.textContent = `ì˜í™” ${RESULTS_COUNT}ê°œì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...`;
            
            const movieIds = await fetchPopularMovieIds();
            
            if (movieIds.length === 0) return;
            
            const movieDetailsPromises = movieIds.map(id => fetchMovieRuntime(id));
            const allMovies = await Promise.all(movieDetailsPromises);

            allMovieData = allMovies.filter(m => m && m.runtime > 0);
            
            loadingStatus.textContent = `${allMovieData.length}ê°œì˜ ì˜í™” ë°ì´í„° ë¡œë“œ ì™„ë£Œ. ê²€ìƒ‰ì„ ì‹œì‘í•˜ì„¸ìš”!`;
            
            // ë°ì´í„° ë¡œë“œ í›„ ê¸°ë³¸ ë²”ìœ„ë¡œ ì²« ê²€ìƒ‰ ì‹¤í–‰
            filterMoviesByRuntime();
        }

        /**
         * 4. ì‚¬ìš©ìì˜ ì…ë ¥ ê°’ìœ¼ë¡œ ì˜í™” ëª©ë¡ì„ í•„í„°ë§í•˜ê³  ê²°ê³¼ë¥¼ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
         */
        function filterMoviesByRuntime() {
            const minTime = parseInt(document.getElementById('min-runtime').value);
            const maxTime = parseInt(document.getElementById('max-runtime').value);

            // ì…ë ¥ ìœ íš¨ì„± ê²€ì‚¬
            if (isNaN(minTime) || isNaN(maxTime) || minTime > maxTime || minTime < 10) {
                resultsContainer.innerHTML = "<p style='color:red;'>âš ï¸ ìœ íš¨í•œ ìµœì†Œ/ìµœëŒ€ ì‹œê°„ ë²”ìœ„(ìµœì†Œ 10ë¶„ ì´ìƒ)ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>";
                return;
            }

            // í•„í„°ë§ ë¡œì§
            const filteredMovies = allMovieData.filter(movie => {
                return movie.runtime >= minTime && movie.runtime <= maxTime;
            });

            // ê²°ê³¼ í‘œì‹œ
            displayResults(filteredMovies, minTime, maxTime);
        }

/**
 * 5. ê²°ê³¼ë¥¼ HTMLì— ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
 */
function displayResults(movies, min, max) {
    // ğŸ’¡ TMDB ì´ë¯¸ì§€ ê¸°ë³¸ URL ì„¤ì •
    const IMAGE_BASE_URL = "https://image.tmdb.org/t/p/";
    const IMAGE_SIZE = "w185"; // í¬ìŠ¤í„° í¬ê¸° (ì•½ 185px ë„ˆë¹„)

    resultsContainer.innerHTML = ''; 
    loadingStatus.textContent = `ì´ ${movies.length}ê°œì˜ ì˜í™”ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤. (ë²”ìœ„: ${min}ë¶„ ~ ${max}ë¶„)`;
    
    if (movies.length === 0) {
        resultsContainer.innerHTML = "<p>ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ì˜í™”ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
        return;
    }

    movies.forEach(movie => {
        // í¬ìŠ¤í„° URL ìƒì„±: ê¸°ë³¸ URL + í¬ê¸° + í¬ìŠ¤í„° ê²½ë¡œ
        const posterUrl = movie.poster_path 
            ? `${IMAGE_BASE_URL}${IMAGE_SIZE}${movie.poster_path}` 
            : 'placeholder.png'; // í¬ìŠ¤í„°ê°€ ì—†ì„ ë•Œ ëŒ€ì²´ ì´ë¯¸ì§€

        const movieElement = document.createElement('div');
        movieElement.className = 'movie-card';
        
        // ğŸ’¡ <img> íƒœê·¸ ì¶”ê°€ ë° ì •ë³´ í‘œì‹œ ì—…ë°ì´íŠ¸
        movieElement.innerHTML = `
            <img src="${posterUrl}" alt="${movie.title} í¬ìŠ¤í„°" class="movie-poster">
            <h3>${movie.title}</h3>
            <p>ëŸ¬ë‹ íƒ€ì„: <strong>${movie.runtime}ë¶„</strong></p>
            <p>${movie.overview.substring(0, 100)}...</p>
        `;
        resultsContainer.appendChild(movieElement);
    });
}
        

        // ì´ë²¤íŠ¸ ì—°ê²° ë° ì´ˆê¸° ë°ì´í„° ë¡œë“œ
        searchButton.addEventListener('click', filterMoviesByRuntime);

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ì´ˆê¸°í™” ì‹œì‘
        initializeData();
    </script>

</body>
</html>
